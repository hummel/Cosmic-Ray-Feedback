\subsection{Cut-out and Refinement}
\label{cutout}

The refined Halo 2 simulations are run from $z=100$ with varying CR background strengths until the gas reaches densities of $10^4\,{\rm cm}^{-3}$.  At this point all particles beyond 10 comoving kpc from the centre of the collapsing minihalo are removed from the simulation and the remaining SPH particles are split into two child particles placed randomly within the smoothing kernel of the parent particle.  This particle-splitting is repeated twice more; all particles within 8 comoving kpc are replaced by 8 child particles; within 6 comoving kpc, each of these child particles is split into an additional 8 for a total of 128 child particles in the most refined region.  This achieves a minimum particle mass of $0.014\msun$, affording a maximum mass resolution of $\lesssim 1\msun$, similar to Halo 1.  At each step, the mass of the parent particle is evenly divided among the child particles and the smoothing length is set to $h N_{\rm new}^{-1/3}$, where $h$ is the smoothing length of the parent and $N_{\rm new}$ is the number of child particles created.  All particles inherit the same entropy, velocity, and chemical abundances as their parent, ensuring conservation of mass, internal energy, and momentum.  This multi-step refinement process reduces the likelihood of two child particles being randomly placed very near each other, thus minimising artificial disruption of the collapse process.

While our cut-out technique leads to a rarefaction wave propagating inward from the suddenly introduced vacuum boundary condition, the average sound speed at the edge of the most refined region is $\sim$$1\,{\rm km}\,{\rm s}^{-1}$.  As a result the wave only travels $\sim$$0.5\,$pc over the remaining 400,000$\,$yr of the simulation, a negligible fraction of the $\sim$350$\,$pc physical box size.